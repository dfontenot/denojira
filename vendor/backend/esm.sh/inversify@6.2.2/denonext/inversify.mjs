/* esm.sh - inversify@6.2.2 */
import"/reflect-metadata@~0.2.2?target=denonext";import{LazyServiceIdentifier as Wt}from"/@inversifyjs/common@1.4.0/denonext/common.mjs";import{LazyServiceIdentifier as Rn}from"/@inversifyjs/common@1.4.0/denonext/common.mjs";import{getTargets as At,getClassElementMetadataFromLegacyMetadata as St,ClassElementMetadataKind as Tt,LegacyTargetImpl as It}from"/@inversifyjs/core@1.3.5/denonext/core.mjs";var f="named",nt="name",q="unmanaged",O="optional",$="inject",V="multi_inject",et="inversify:tagged",it="inversify:tagged_props",L="inversify:paramtypes",rt="design:paramtypes",F="post_construct",R="pre_destroy",Gt=[$,V,nt,q,f,O],Kt=Object.freeze({__proto__:null,DESIGN_PARAM_TYPES:rt,INJECT_TAG:$,MULTI_INJECT_TAG:V,NAMED_TAG:f,NAME_TAG:nt,NON_CUSTOM_TAG_KEYS:Gt,OPTIONAL_TAG:O,PARAM_TYPES:L,POST_CONSTRUCT:F,PRE_DESTROY:R,TAGGED:et,TAGGED_PROP:it,UNMANAGED_TAG:q}),l={Request:"Request",Singleton:"Singleton",Transient:"Transient"},h={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},Dt={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},Ht=0;function D(){return Ht++}var U=class i{id;moduleId;activated;serviceIdentifier;implementationType;cache;dynamicValue;scope;type;factory;provider;constraint;onActivation;onDeactivation;constructor(t,n){this.id=D(),this.activated=!1,this.serviceIdentifier=t,this.scope=n,this.type=h.Invalid,this.constraint=e=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}clone(){let t=new i(this.serviceIdentifier,this.scope);return t.activated=t.scope===l.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.onDeactivation=this.onDeactivation,t.cache=this.cache,t}},Nt="Metadata key was used more than once in a parameter:",dt="NULL argument",ut="Key Not Found",Lt="Ambiguous match found for serviceIdentifier:",Ut="No matching bindings found for serviceIdentifier:",Ct="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",Y=(i,t)=>`onDeactivation() error in class ${i}: ${t}`,z=class{getConstructorMetadata(t){return{compilerGeneratedMetadata:Reflect.getMetadata(rt,t)??[],userGeneratedMetadata:Reflect.getMetadata(et,t)??{}}}getPropertiesMetadata(t){return Reflect.getMetadata(it,t)??{}}},T;function Et(i){return i instanceof RangeError||i.message==="Maximum call stack size exceeded"}(function(i){i[i.MultipleBindingsAvailable=2]="MultipleBindingsAvailable",i[i.NoBindingsAvailable=0]="NoBindingsAvailable",i[i.OnlyOneBindingAvailable=1]="OnlyOneBindingAvailable"})(T||(T={}));function S(i){return typeof i=="function"?i.name:typeof i=="symbol"?i.toString():i}function ht(i,t,n){let e="",r=n(i,t);return r.length!==0&&(e=`
Registered bindings:`,r.forEach((s=>{let a="Object";s.implementationType!==null&&(a=Mt(s.implementationType)),e=`${e}
 ${a}`,s.constraint.metaData&&(e=`${e} - ${s.constraint.metaData}`)}))),e}function Rt(i,t){return i.parentRequest!==null&&(i.parentRequest.serviceIdentifier===t||Rt(i.parentRequest,t))}function xt(i){i.childRequests.forEach((t=>{if(Rt(i,t.serviceIdentifier)){let n=(function(e){return(function s(a,c=[]){let o=S(a.serviceIdentifier);return c.push(o),a.parentRequest!==null?s(a.parentRequest,c):c})(e).reverse().join(" --> ")})(t);throw new Error(`Circular dependency found: ${n}`)}xt(t)}))}function Mt(i){if(i.name!=null&&i.name!=="")return i.name;{let t=i.toString(),n=t.match(/^function\s*([^\s(]+)/);return n===null?`Anonymous function: ${t}`:n[1]}}function lt(i){return`{"key":"${i.key.toString()}","value":"${i.value.toString()}"}`}var P=class{id;container;plan;currentRequest;constructor(t){this.id=D(),this.container=t}addPlan(t){this.plan=t}setCurrentRequest(t){this.currentRequest=t}},v=class{key;value;constructor(t,n){this.key=t,this.value=n}toString(){return this.key===f?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}},J=class{parentContext;rootRequest;constructor(t,n){this.parentContext=t,this.rootRequest=n}};function Bt(i,t){let n=(function(c){return Object.getPrototypeOf(c.prototype)?.constructor})(t);if(n===void 0||n===Object)return 0;let e=At(i)(n),r=e.map((c=>c.metadata.filter((o=>o.key===q)))),s=[].concat.apply([],r).length,a=e.length-s;return a>0?a:Bt(i,n)}var x=class i{id;serviceIdentifier;parentContext;parentRequest;bindings;childRequests;target;requestScope;constructor(t,n,e,r,s){this.id=D(),this.serviceIdentifier=t,this.parentContext=n,this.parentRequest=e,this.target=s,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=e===null?new Map:null}addChildRequest(t,n,e){let r=new i(t,this.parentContext,this,n,e);return this.childRequests.push(r),r}};function j(i){return i._bindingDictionary}function gt(i,t,n,e,r){let s=N(n.container,r.serviceIdentifier),a=[];return s.length===T.NoBindingsAvailable&&n.container.options.autoBindInjectable===!0&&typeof r.serviceIdentifier=="function"&&i.getConstructorMetadata(r.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(r.serviceIdentifier).toSelf(),s=N(n.container,r.serviceIdentifier)),a=t?s:s.filter((c=>{let o=new x(c.serviceIdentifier,n,e,c,r);return c.constraint(o)})),(function(c,o,d,u,y){switch(o.length){case T.NoBindingsAvailable:if(u.isOptional())return o;{let p=S(c),m=Ut;throw m+=(function(G,M){if(M.isTagged()||M.isNamed()){let K="",ot=M.getNamedTag(),ct=M.getCustomTags();return ot!==null&&(K+=lt(ot)+`
`),ct!==null&&ct.forEach((Vt=>{K+=lt(Vt)+`
`})),` ${G}
 ${G} - ${K}`}return` ${G}`})(p,u),m+=ht(y,p,N),d!==null&&(m+=`
Trying to resolve bindings for "${S(d.serviceIdentifier)}"`),new Error(m)}case T.OnlyOneBindingAvailable:return o;case T.MultipleBindingsAvailable:default:if(u.isArray())return o;{let p=S(c),m=`${Lt} ${p}`;throw m+=ht(y,p,N),new Error(m)}}})(r.serviceIdentifier,a,e,r,n.container),a}function Ft(i,t){let n=t.isMultiInject?V:$,e=[new v(n,i)];return t.customTag!==void 0&&e.push(new v(t.customTag.key,t.customTag.value)),t.isOptional===!0&&e.push(new v(O,!0)),e}function Pt(i,t,n,e,r,s){let a,c;if(r===null){a=gt(i,t,e,null,s),c=new x(n,e,null,a,s);let o=new J(e,c);e.addPlan(o)}else a=gt(i,t,e,r,s),c=r.addChildRequest(s.serviceIdentifier,a,s);a.forEach((o=>{let d=null;if(s.isArray())d=c.addChildRequest(o.serviceIdentifier,o,s);else{if(o.cache!==null)return;d=c}if(o.type===h.Instance&&o.implementationType!==null){let u=(function(y,p){return At(y)(p)})(i,o.implementationType);if(e.container.options.skipBaseClassChecks!==!0){let y=Bt(i,o.implementationType);if(u.length<y){let p=`The number of constructor arguments in the derived class ${Mt(o.implementationType)} must be >= than the number of constructor arguments of its base class.`;throw new Error(p)}}u.forEach((y=>{Pt(i,!1,y.serviceIdentifier,e,d,y)}))}}))}function N(i,t){let n=[],e=j(i);return e.hasKey(t)?n=e.get(t):i.parent!==null&&(n=N(i.parent,t)),n}function Yt(i,t,n,e,r,s=!1){let a=new P(t),c=(function(o,d,u){let y=Ft(d,u),p=St(y);if(p.kind===Tt.unmanaged)throw new Error("Unexpected metadata when creating target");return new It("",p,o)})(n,e,r);try{return Pt(i,s,e,a,null,c),a}catch(o){throw Et(o)&&xt(a.plan.rootRequest),o}}function _(i){return(typeof i=="object"&&i!==null||typeof i=="function")&&typeof i.then=="function"}function jt(i){return!!_(i)||Array.isArray(i)&&i.some(_)}var zt=(i,t,n)=>{i.has(t.id)||i.set(t.id,n)},Jt=(i,t)=>{i.cache=t,i.activated=!0,_(t)&&Qt(i,t)},Qt=async(i,t)=>{try{let n=await t;i.cache=n}catch(n){throw i.cache=null,i.activated=!1,n}},E;(function(i){i.DynamicValue="toDynamicValue",i.Factory="toFactory",i.Provider="toProvider"})(E||(E={}));var yn=i=>t=>(...n)=>{n.forEach((e=>{i.bind(e).toService(t)}))};function Xt(i,t,n){let e;if(t.length>0){let r=(function(a,c){return a.reduce(((o,d)=>{let u=c(d);return d.target.type===Dt.ConstructorArgument?o.constructorInjections.push(u):(o.propertyRequests.push(d),o.propertyInjections.push(u)),o.isAsync||(o.isAsync=jt(u)),o}),{constructorInjections:[],isAsync:!1,propertyInjections:[],propertyRequests:[]})})(t,n),s={...r,constr:i};e=r.isAsync?(async function(a){let c=await pt(a.constructorInjections),o=await pt(a.propertyInjections);return yt({...a,constructorInjections:c,propertyInjections:o})})(s):yt(s)}else e=new i;return e}function yt(i){let t=new i.constr(...i.constructorInjections);return i.propertyRequests.forEach(((n,e)=>{let r=n.target.identifier,s=i.propertyInjections[e];n.target.isOptional()&&s===void 0||(t[r]=s)})),t}async function pt(i){let t=[];for(let n of i)Array.isArray(n)?t.push(Promise.all(n)):t.push(n);return Promise.all(t)}function ft(i,t){let n=(function(e,r){if(Reflect.hasMetadata(F,e)){let c=Reflect.getMetadata(F,e);try{return r[c.value]?.()}catch(o){if(o instanceof Error)throw new Error((s=e.name,a=o.message,`@postConstruct error in class ${s}: ${a}`))}}var s,a})(i,t);return _(n)?n.then((()=>t)):t}function Zt(i,t){i.scope!==l.Singleton&&(function(n,e){let r=`Class cannot be instantiated in ${n.scope===l.Request?"request":"transient"} scope.`;if(typeof n.onDeactivation=="function")throw new Error(Y(e.name,r));if(Reflect.hasMetadata(R,e))throw new Error(`@preDestroy error in class ${e.name}: ${r}`)})(i,t)}var st=i=>t=>{t.parentContext.setCurrentRequest(t);let n=t.bindings,e=t.childRequests,r=t.target&&t.target.isArray(),s=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(r&&s)return e.map((a=>st(i)(a)));{if(t.target.isOptional()&&n.length===0)return;let a=n[0];return rn(i,t,a)}},tn=(i,t)=>{let n=(e=>{switch(e.type){case h.Factory:return{factory:e.factory,factoryType:E.Factory};case h.Provider:return{factory:e.provider,factoryType:E.Provider};case h.DynamicValue:return{factory:e.dynamicValue,factoryType:E.DynamicValue};default:throw new Error(`Unexpected factory type ${e.type}`)}})(i);return((e,r)=>{try{return e()}catch(s){throw Et(s)?r():s}})((()=>n.factory.bind(i)(t)),(()=>{return new Error((e=n.factoryType,r=t.currentRequest.serviceIdentifier.toString(),`It looks like there is a circular dependency in one of the '${e}' bindings. Please investigate bindings with service identifier '${r}'.`));var e,r}))},nn=(i,t,n)=>{let e,r=t.childRequests;switch((s=>{let a=null;switch(s.type){case h.ConstantValue:case h.Function:a=s.cache;break;case h.Constructor:case h.Instance:a=s.implementationType;break;case h.DynamicValue:a=s.dynamicValue;break;case h.Provider:a=s.provider;break;case h.Factory:a=s.factory}if(a===null){let c=S(s.serviceIdentifier);throw new Error(`Invalid binding type: ${c}`)}})(n),n.type){case h.ConstantValue:case h.Function:e=n.cache;break;case h.Constructor:e=n.implementationType;break;case h.Instance:e=(function(s,a,c,o){Zt(s,a);let d=Xt(a,c,o);return _(d)?d.then((u=>ft(a,u))):ft(a,d)})(n,n.implementationType,r,st(i));break;default:e=tn(n,t.parentContext)}return e},en=(i,t,n)=>{let e=((r,s)=>s.scope===l.Singleton&&s.activated?s.cache:s.scope===l.Request&&r.has(s.id)?r.get(s.id):null)(i,t);return e!==null||(e=n(),((r,s,a)=>{s.scope===l.Singleton&&Jt(s,a),s.scope===l.Request&&zt(r,s,a)})(i,t,e)),e},rn=(i,t,n)=>en(i,n,(()=>{let e=nn(i,t,n);return e=_(e)?e.then((r=>_t(t,n,r))):_t(t,n,e),e}));function _t(i,t,n){let e=sn(i.parentContext,t,n),r=cn(i.parentContext.container),s,a=r.next();do{s=a.value;let c=i.parentContext,o=i.serviceIdentifier,d=on(s,o);e=_(e)?kt(d,c,e):an(d,c,e),a=r.next()}while(a.done!==!0&&!j(s).hasKey(i.serviceIdentifier));return e}var sn=(i,t,n)=>{let e;return e=typeof t.onActivation=="function"?t.onActivation(i,n):n,e},an=(i,t,n)=>{let e=i.next();for(;e.done!==!0;){if(_(n=e.value(t,n)))return kt(i,t,n);e=i.next()}return n},kt=async(i,t,n)=>{let e=await n,r=i.next();for(;r.done!==!0;)e=await r.value(t,e),r=i.next();return e},on=(i,t)=>{let n=i._activations;return n.hasKey(t)?n.get(t).values():[].values()},cn=i=>{let t=[i],n=i.parent;for(;n!==null;)t.push(n),n=n.parent;return{next:()=>{let e=t.pop();return e!==void 0?{done:!1,value:e}:{done:!0,value:void 0}}}},w=(i,t)=>{let n=i.parentRequest;return n!==null&&(!!t(n)||w(n,t))},C=i=>t=>{let n=e=>e!==null&&e.target!==null&&e.target.matchesTag(i)(t);return n.metaData=new v(i,t),n},B=C(f),H=i=>t=>{let n=null;if(t!==null){if(n=t.bindings[0],typeof i=="string")return n.serviceIdentifier===i;{let e=t.bindings[0].implementationType;return i===e}}return!1},I=class{_binding;constructor(t){this._binding=t}when(t){return this._binding.constraint=t,new g(this._binding)}whenTargetNamed(t){return this._binding.constraint=B(t),new g(this._binding)}whenTargetIsDefault(){return this._binding.constraint=t=>t===null?!1:t.target!==null&&!t.target.isNamed()&&!t.target.isTagged(),new g(this._binding)}whenTargetTagged(t,n){return this._binding.constraint=C(t)(n),new g(this._binding)}whenInjectedInto(t){return this._binding.constraint=n=>n!==null&&H(t)(n.parentRequest),new g(this._binding)}whenParentNamed(t){return this._binding.constraint=n=>n!==null&&B(t)(n.parentRequest),new g(this._binding)}whenParentTagged(t,n){return this._binding.constraint=e=>e!==null&&C(t)(n)(e.parentRequest),new g(this._binding)}whenAnyAncestorIs(t){return this._binding.constraint=n=>n!==null&&w(n,H(t)),new g(this._binding)}whenNoAncestorIs(t){return this._binding.constraint=n=>n!==null&&!w(n,H(t)),new g(this._binding)}whenAnyAncestorNamed(t){return this._binding.constraint=n=>n!==null&&w(n,B(t)),new g(this._binding)}whenNoAncestorNamed(t){return this._binding.constraint=n=>n!==null&&!w(n,B(t)),new g(this._binding)}whenAnyAncestorTagged(t,n){return this._binding.constraint=e=>e!==null&&w(e,C(t)(n)),new g(this._binding)}whenNoAncestorTagged(t,n){return this._binding.constraint=e=>e!==null&&!w(e,C(t)(n)),new g(this._binding)}whenAnyAncestorMatches(t){return this._binding.constraint=n=>n!==null&&w(n,t),new g(this._binding)}whenNoAncestorMatches(t){return this._binding.constraint=n=>n!==null&&!w(n,t),new g(this._binding)}},g=class{_binding;constructor(t){this._binding=t}onActivation(t){return this._binding.onActivation=t,new I(this._binding)}onDeactivation(t){return this._binding.onDeactivation=t,new I(this._binding)}},b=class{_bindingWhenSyntax;_bindingOnSyntax;_binding;constructor(t){this._binding=t,this._bindingWhenSyntax=new I(this._binding),this._bindingOnSyntax=new g(this._binding)}when(t){return this._bindingWhenSyntax.when(t)}whenTargetNamed(t){return this._bindingWhenSyntax.whenTargetNamed(t)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(t,n){return this._bindingWhenSyntax.whenTargetTagged(t,n)}whenInjectedInto(t){return this._bindingWhenSyntax.whenInjectedInto(t)}whenParentNamed(t){return this._bindingWhenSyntax.whenParentNamed(t)}whenParentTagged(t,n){return this._bindingWhenSyntax.whenParentTagged(t,n)}whenAnyAncestorIs(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)}whenNoAncestorIs(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)}whenAnyAncestorNamed(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)}whenAnyAncestorTagged(t,n){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,n)}whenNoAncestorNamed(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)}whenNoAncestorTagged(t,n){return this._bindingWhenSyntax.whenNoAncestorTagged(t,n)}whenAnyAncestorMatches(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)}whenNoAncestorMatches(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)}onActivation(t){return this._bindingOnSyntax.onActivation(t)}onDeactivation(t){return this._bindingOnSyntax.onDeactivation(t)}},Q=class{_binding;constructor(t){this._binding=t}inRequestScope(){return this._binding.scope=l.Request,new b(this._binding)}inSingletonScope(){return this._binding.scope=l.Singleton,new b(this._binding)}inTransientScope(){return this._binding.scope=l.Transient,new b(this._binding)}},k=class{_bindingInSyntax;_bindingWhenSyntax;_bindingOnSyntax;_binding;constructor(t){this._binding=t,this._bindingWhenSyntax=new I(this._binding),this._bindingOnSyntax=new g(this._binding),this._bindingInSyntax=new Q(t)}inRequestScope(){return this._bindingInSyntax.inRequestScope()}inSingletonScope(){return this._bindingInSyntax.inSingletonScope()}inTransientScope(){return this._bindingInSyntax.inTransientScope()}when(t){return this._bindingWhenSyntax.when(t)}whenTargetNamed(t){return this._bindingWhenSyntax.whenTargetNamed(t)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(t,n){return this._bindingWhenSyntax.whenTargetTagged(t,n)}whenInjectedInto(t){return this._bindingWhenSyntax.whenInjectedInto(t)}whenParentNamed(t){return this._bindingWhenSyntax.whenParentNamed(t)}whenParentTagged(t,n){return this._bindingWhenSyntax.whenParentTagged(t,n)}whenAnyAncestorIs(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)}whenNoAncestorIs(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)}whenAnyAncestorNamed(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)}whenAnyAncestorTagged(t,n){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,n)}whenNoAncestorNamed(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)}whenNoAncestorTagged(t,n){return this._bindingWhenSyntax.whenNoAncestorTagged(t,n)}whenAnyAncestorMatches(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)}whenNoAncestorMatches(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)}onActivation(t){return this._bindingOnSyntax.onActivation(t)}onDeactivation(t){return this._bindingOnSyntax.onDeactivation(t)}},X=class{_binding;constructor(t){this._binding=t}to(t){return this._binding.type=h.Instance,this._binding.implementationType=t,new k(this._binding)}toSelf(){if(typeof this._binding.serviceIdentifier!="function")throw new Error("The toSelf function can only be applied when a constructor is used as service identifier");let t=this._binding.serviceIdentifier;return this.to(t)}toConstantValue(t){return this._binding.type=h.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=l.Singleton,new b(this._binding)}toDynamicValue(t){return this._binding.type=h.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new k(this._binding)}toConstructor(t){return this._binding.type=h.Constructor,this._binding.implementationType=t,this._binding.scope=l.Singleton,new b(this._binding)}toFactory(t){return this._binding.type=h.Factory,this._binding.factory=t,this._binding.scope=l.Singleton,new b(this._binding)}toFunction(t){if(typeof t!="function")throw new Error("Value provided to function binding must be a function!");let n=this.toConstantValue(t);return this._binding.type=h.Function,this._binding.scope=l.Singleton,n}toAutoFactory(t){return this._binding.type=h.Factory,this._binding.factory=n=>()=>n.container.get(t),this._binding.scope=l.Singleton,new b(this._binding)}toAutoNamedFactory(t){return this._binding.type=h.Factory,this._binding.factory=n=>e=>n.container.getNamed(t,e),new b(this._binding)}toProvider(t){return this._binding.type=h.Provider,this._binding.provider=t,this._binding.scope=l.Singleton,new b(this._binding)}toService(t){this._binding.type=h.DynamicValue,Object.defineProperty(this._binding,"cache",{configurable:!0,enumerable:!0,get:()=>null,set(n){}}),this._binding.dynamicValue=n=>{try{return n.container.get(t)}catch{return n.container.getAsync(t)}},this._binding.implementationType=null}},Z=class i{bindings;activations;deactivations;middleware;moduleActivationStore;static of(t,n,e,r,s){let a=new i;return a.bindings=t,a.middleware=n,a.deactivations=r,a.activations=e,a.moduleActivationStore=s,a}},A=class i{_map;constructor(){this._map=new Map}getMap(){return this._map}add(t,n){if(this._checkNonNulish(t),n==null)throw new Error(dt);let e=this._map.get(t);e!==void 0?e.push(n):this._map.set(t,[n])}get(t){this._checkNonNulish(t);let n=this._map.get(t);if(n!==void 0)return n;throw new Error(ut)}remove(t){if(this._checkNonNulish(t),!this._map.delete(t))throw new Error(ut)}removeIntersection(t){this.traverse(((n,e)=>{let r=t.hasKey(n)?t.get(n):void 0;if(r!==void 0){let s=e.filter((a=>!r.some((c=>a===c))));this._setValue(n,s)}}))}removeByCondition(t){let n=[];return this._map.forEach(((e,r)=>{let s=[];for(let a of e)t(a)?n.push(a):s.push(a);this._setValue(r,s)})),n}hasKey(t){return this._checkNonNulish(t),this._map.has(t)}clone(){let t=new i;return this._map.forEach(((n,e)=>{n.forEach((r=>{var s;t.add(e,typeof(s=r)=="object"&&s!==null&&"clone"in s&&typeof s.clone=="function"?r.clone():r)}))})),t}traverse(t){this._map.forEach(((n,e)=>{t(e,n)}))}_checkNonNulish(t){if(t==null)throw new Error(dt)}_setValue(t,n){n.length>0?this._map.set(t,n):this._map.delete(t)}},tt=class i{_map=new Map;remove(t){let n=this._map.get(t);return n===void 0?this._getEmptyHandlersStore():(this._map.delete(t),n)}addDeactivation(t,n,e){this._getModuleActivationHandlers(t).onDeactivations.add(n,e)}addActivation(t,n,e){this._getModuleActivationHandlers(t).onActivations.add(n,e)}clone(){let t=new i;return this._map.forEach(((n,e)=>{t._map.set(e,{onActivations:n.onActivations.clone(),onDeactivations:n.onDeactivations.clone()})})),t}_getModuleActivationHandlers(t){let n=this._map.get(t);return n===void 0&&(n=this._getEmptyHandlersStore(),this._map.set(t,n)),n}_getEmptyHandlersStore(){return{onActivations:new A,onDeactivations:new A}}},vt=class i{id;parent;options;_middleware;_bindingDictionary;_activations;_deactivations;_snapshots;_metadataReader;_moduleActivationStore;constructor(t){let n=t||{};if(typeof n!="object")throw new Error("Invalid Container constructor argument. Container options must be an object.");if(n.defaultScope===void 0)n.defaultScope=l.Transient;else if(n.defaultScope!==l.Singleton&&n.defaultScope!==l.Transient&&n.defaultScope!==l.Request)throw new Error('Invalid Container option. Default scope must be a string ("singleton" or "transient").');if(n.autoBindInjectable===void 0)n.autoBindInjectable=!1;else if(typeof n.autoBindInjectable!="boolean")throw new Error("Invalid Container option. Auto bind injectable must be a boolean");if(n.skipBaseClassChecks===void 0)n.skipBaseClassChecks=!1;else if(typeof n.skipBaseClassChecks!="boolean")throw new Error("Invalid Container option. Skip base check must be a boolean");this.options={autoBindInjectable:n.autoBindInjectable,defaultScope:n.defaultScope,skipBaseClassChecks:n.skipBaseClassChecks},this.id=D(),this._bindingDictionary=new A,this._snapshots=[],this._middleware=null,this._activations=new A,this._deactivations=new A,this.parent=null,this._metadataReader=new z,this._moduleActivationStore=new tt}static merge(t,n,...e){let r=new i,s=[t,n,...e].map((c=>j(c))),a=j(r);return s.forEach((c=>{var o;o=a,c.traverse(((d,u)=>{u.forEach((y=>{o.add(y.serviceIdentifier,y.clone())}))}))})),r}load(...t){let n=this._getContainerModuleHelpersFactory();for(let e of t){let r=n(e.id);e.registry(r.bindFunction,r.unbindFunction,r.isboundFunction,r.rebindFunction,r.unbindAsyncFunction,r.onActivationFunction,r.onDeactivationFunction)}}async loadAsync(...t){let n=this._getContainerModuleHelpersFactory();for(let e of t){let r=n(e.id);await e.registry(r.bindFunction,r.unbindFunction,r.isboundFunction,r.rebindFunction,r.unbindAsyncFunction,r.onActivationFunction,r.onDeactivationFunction)}}unload(...t){t.forEach((n=>{let e=this._removeModuleBindings(n.id);this._deactivateSingletons(e),this._removeModuleHandlers(n.id)}))}async unloadAsync(...t){for(let n of t){let e=this._removeModuleBindings(n.id);await this._deactivateSingletonsAsync(e),this._removeModuleHandlers(n.id)}}bind(t){return this._bind(this._buildBinding(t))}rebind(t){return this.unbind(t),this.bind(t)}async rebindAsync(t){return await this.unbindAsync(t),this.bind(t)}unbind(t){if(this._bindingDictionary.hasKey(t)){let n=this._bindingDictionary.get(t);this._deactivateSingletons(n)}this._removeServiceFromDictionary(t)}async unbindAsync(t){if(this._bindingDictionary.hasKey(t)){let n=this._bindingDictionary.get(t);await this._deactivateSingletonsAsync(n)}this._removeServiceFromDictionary(t)}unbindAll(){this._bindingDictionary.traverse(((t,n)=>{this._deactivateSingletons(n)})),this._bindingDictionary=new A}async unbindAllAsync(){let t=[];this._bindingDictionary.traverse(((n,e)=>{t.push(this._deactivateSingletonsAsync(e))})),await Promise.all(t),this._bindingDictionary=new A}onActivation(t,n){this._activations.add(t,n)}onDeactivation(t,n){this._deactivations.add(t,n)}isBound(t){let n=this._bindingDictionary.hasKey(t);return!n&&this.parent&&(n=this.parent.isBound(t)),n}isCurrentBound(t){return this._bindingDictionary.hasKey(t)}isBoundNamed(t,n){return this.isBoundTagged(t,f,n)}isBoundTagged(t,n,e){let r=!1;if(this._bindingDictionary.hasKey(t)){let s=this._bindingDictionary.get(t),a=(function(c,o,d){let u=Ft(o,d),y=St(u);if(y.kind===Tt.unmanaged)throw new Error("Unexpected metadata when creating target");let p=new It("",y,"Variable"),m=new P(c);return new x(o,m,null,[],p)})(this,t,{customTag:{key:n,value:e},isMultiInject:!1});r=s.some((c=>c.constraint(a)))}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,n,e)),r}snapshot(){this._snapshots.push(Z.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))}restore(){let t=this._snapshots.pop();if(t===void 0)throw new Error("No snapshot available to restore.");this._bindingDictionary=t.bindings,this._activations=t.activations,this._deactivations=t.deactivations,this._middleware=t.middleware,this._moduleActivationStore=t.moduleActivationStore}createChild(t){let n=new i(t||this.options);return n.parent=this,n}applyMiddleware(...t){let n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce(((e,r)=>r(e)),n)}applyCustomMetadataReader(t){this._metadataReader=t}get(t){let n=this._getNotAllArgs(t,!1,!1);return this._getButThrowIfAsync(n)}async getAsync(t){let n=this._getNotAllArgs(t,!1,!1);return this._get(n)}getTagged(t,n,e){let r=this._getNotAllArgs(t,!1,!1,n,e);return this._getButThrowIfAsync(r)}async getTaggedAsync(t,n,e){let r=this._getNotAllArgs(t,!1,!1,n,e);return this._get(r)}getNamed(t,n){return this.getTagged(t,f,n)}async getNamedAsync(t,n){return this.getTaggedAsync(t,f,n)}getAll(t,n){let e=this._getAllArgs(t,n,!1);return this._getButThrowIfAsync(e)}async getAllAsync(t,n){let e=this._getAllArgs(t,n,!1);return this._getAll(e)}getAllTagged(t,n,e){let r=this._getNotAllArgs(t,!0,!1,n,e);return this._getButThrowIfAsync(r)}async getAllTaggedAsync(t,n,e){let r=this._getNotAllArgs(t,!0,!1,n,e);return this._getAll(r)}getAllNamed(t,n){return this.getAllTagged(t,f,n)}async getAllNamedAsync(t,n){return this.getAllTaggedAsync(t,f,n)}resolve(t){let n=this.isBound(t);n||this.bind(t).toSelf();let e=this.get(t);return n||this.unbind(t),e}tryGet(t){let n=this._getNotAllArgs(t,!1,!0);return this._getButThrowIfAsync(n)}async tryGetAsync(t){let n=this._getNotAllArgs(t,!1,!0);return this._get(n)}tryGetTagged(t,n,e){let r=this._getNotAllArgs(t,!1,!0,n,e);return this._getButThrowIfAsync(r)}async tryGetTaggedAsync(t,n,e){let r=this._getNotAllArgs(t,!1,!0,n,e);return this._get(r)}tryGetNamed(t,n){return this.tryGetTagged(t,f,n)}async tryGetNamedAsync(t,n){return this.tryGetTaggedAsync(t,f,n)}tryGetAll(t,n){let e=this._getAllArgs(t,n,!0);return this._getButThrowIfAsync(e)}async tryGetAllAsync(t,n){let e=this._getAllArgs(t,n,!0);return this._getAll(e)}tryGetAllTagged(t,n,e){let r=this._getNotAllArgs(t,!0,!0,n,e);return this._getButThrowIfAsync(r)}async tryGetAllTaggedAsync(t,n,e){let r=this._getNotAllArgs(t,!0,!0,n,e);return this._getAll(r)}tryGetAllNamed(t,n){return this.tryGetAllTagged(t,f,n)}async tryGetAllNamedAsync(t,n){return this.tryGetAllTaggedAsync(t,f,n)}_preDestroy(t,n){if(t!==void 0&&Reflect.hasMetadata(R,t)){let e=Reflect.getMetadata(R,t);return n[e.value]?.()}}_removeModuleHandlers(t){let n=this._moduleActivationStore.remove(t);this._activations.removeIntersection(n.onActivations),this._deactivations.removeIntersection(n.onDeactivations)}_removeModuleBindings(t){return this._bindingDictionary.removeByCondition((n=>n.moduleId===t))}_deactivate(t,n){let e=n==null?void 0:Object.getPrototypeOf(n).constructor;try{if(this._deactivations.hasKey(t.serviceIdentifier)){let s=this._deactivateContainer(n,this._deactivations.get(t.serviceIdentifier).values());if(_(s))return this._handleDeactivationError(s.then((async()=>this._propagateContainerDeactivationThenBindingAndPreDestroyAsync(t,n,e))),t.serviceIdentifier)}let r=this._propagateContainerDeactivationThenBindingAndPreDestroy(t,n,e);if(_(r))return this._handleDeactivationError(r,t.serviceIdentifier)}catch(r){if(r instanceof Error)throw new Error(Y(S(t.serviceIdentifier),r.message))}}async _handleDeactivationError(t,n){try{await t}catch(e){if(e instanceof Error)throw new Error(Y(S(n),e.message))}}_deactivateContainer(t,n){let e=n.next();for(;typeof e.value=="function";){let r=e.value(t);if(_(r))return r.then((async()=>this._deactivateContainerAsync(t,n)));e=n.next()}}async _deactivateContainerAsync(t,n){let e=n.next();for(;typeof e.value=="function";)await e.value(t),e=n.next()}_getContainerModuleHelpersFactory(){let t=o=>d=>{let u=this._buildBinding(d);return u.moduleId=o,this._bind(u)},n=()=>o=>{this.unbind(o)},e=()=>async o=>this.unbindAsync(o),r=()=>o=>this.isBound(o),s=o=>{let d=t(o);return u=>(this.unbind(u),d(u))},a=o=>(d,u)=>{this._moduleActivationStore.addActivation(o,d,u),this.onActivation(d,u)},c=o=>(d,u)=>{this._moduleActivationStore.addDeactivation(o,d,u),this.onDeactivation(d,u)};return o=>({bindFunction:t(o),isboundFunction:r(),onActivationFunction:a(o),onDeactivationFunction:c(o),rebindFunction:s(o),unbindAsyncFunction:e(),unbindFunction:n()})}_bind(t){return this._bindingDictionary.add(t.serviceIdentifier,t),new X(t)}_buildBinding(t){let n=this.options.defaultScope||l.Transient;return new U(t,n)}async _getAll(t){return Promise.all(this._get(t))}_get(t){let n={...t,contextInterceptor:e=>e,targetType:Dt.Variable};if(this._middleware){let e=this._middleware(n);if(e==null)throw new Error("Invalid return type in middleware. Middleware must return!");return e}return this._planAndResolve()(n)}_getButThrowIfAsync(t){let n=this._get(t);if(jt(n))throw new Error(`You are attempting to construct ${(function(e){return typeof e=="function"?`[function/class ${e.name||"<anonymous>"}]`:typeof e=="symbol"?e.toString():`'${e}'`})(t.serviceIdentifier)} in a synchronous way but it has asynchronous dependencies.`);return n}_getAllArgs(t,n,e){return{avoidConstraints:!n?.enforceBindingConstraints,isMultiInject:!0,isOptional:e,serviceIdentifier:t}}_getNotAllArgs(t,n,e,r,s){return{avoidConstraints:!1,isMultiInject:n,isOptional:e,key:r,serviceIdentifier:t,value:s}}_getPlanMetadataFromNextArgs(t){let n={isMultiInject:t.isMultiInject};return t.key!==void 0&&(n.customTag={key:t.key,value:t.value}),t.isOptional===!0&&(n.isOptional=!0),n}_planAndResolve(){return t=>{let n=Yt(this._metadataReader,this,t.targetType,t.serviceIdentifier,this._getPlanMetadataFromNextArgs(t),t.avoidConstraints);return n=t.contextInterceptor(n),(function(r){return st(r.plan.rootRequest.requestScope)(r.plan.rootRequest)})(n)}}_deactivateIfSingleton(t){if(t.activated)return _(t.cache)?t.cache.then((n=>this._deactivate(t,n))):this._deactivate(t,t.cache)}_deactivateSingletons(t){for(let n of t)if(_(this._deactivateIfSingleton(n)))throw new Error("Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)")}async _deactivateSingletonsAsync(t){await Promise.all(t.map((async n=>this._deactivateIfSingleton(n))))}_propagateContainerDeactivationThenBindingAndPreDestroy(t,n,e){return this.parent?this._deactivate.bind(this.parent)(t,n):this._bindingDeactivationAndPreDestroy(t,n,e)}async _propagateContainerDeactivationThenBindingAndPreDestroyAsync(t,n,e){this.parent?await this._deactivate.bind(this.parent)(t,n):await this._bindingDeactivationAndPreDestroyAsync(t,n,e)}_removeServiceFromDictionary(t){try{this._bindingDictionary.remove(t)}catch{throw new Error(`Could not unbind serviceIdentifier: ${S(t)}`)}}_bindingDeactivationAndPreDestroy(t,n,e){if(typeof t.onDeactivation=="function"){let r=t.onDeactivation(n);if(_(r))return r.then((()=>this._preDestroy(e,n)))}return this._preDestroy(e,n)}async _bindingDeactivationAndPreDestroyAsync(t,n,e){typeof t.onDeactivation=="function"&&await t.onDeactivation(n),await this._preDestroy(e,n)}},bt=class{id;registry;constructor(t){this.id=D(),this.registry=t}},mt=class{id;registry;constructor(t){this.id=D(),this.registry=t}};function at(i,t,n,e){(function(r){if(r!==void 0)throw new Error(Ct)})(t),qt(et,i,n.toString(),e)}function dn(i){let t=[];if(Array.isArray(i)){t=i;let n=(function(e){let r=new Set;for(let s of e){if(r.has(s))return s;r.add(s)}})(t.map((e=>e.key)));if(n!==void 0)throw new Error(`${Nt} ${n.toString()}`)}else t=[i];return t}function qt(i,t,n,e){let r=dn(e),s={};Reflect.hasOwnMetadata(i,t)&&(s=Reflect.getMetadata(i,t));let a=s[n];if(a===void 0)a=[];else for(let c of a)if(r.some((o=>o.key===c.key)))throw new Error(`${Nt} ${c.key.toString()}`);a.push(...r),s[n]=a,Reflect.defineMetadata(i,s,t)}function W(i){return(t,n,e)=>{typeof e=="number"?at(t,n,e,i):(function(r,s,a){if(r.prototype!==void 0)throw new Error(Ct);qt(it,r.constructor,s,a)})(t,n,i)}}function wt(i,t){Reflect.decorate(i,t)}function un(i,t){return function(n,e){t(n,e,i)}}function pn(i,t,n){typeof n=="number"?wt([un(n,i)],t):typeof n=="string"?Reflect.decorate([i],t,n):wt([i],t)}function fn(){return function(i){if(Reflect.hasOwnMetadata(L,i))throw new Error("Cannot apply @injectable decorator multiple times.");let t=Reflect.getMetadata(rt,i)||[];return Reflect.defineMetadata(L,t,i),i}}function _n(i,t){return W(new v(i,t))}function vn(i){return W(new v(f,i))}function Ot(i){return t=>(n,e,r)=>{if(t===void 0){let s=typeof n=="function"?n.name:n.constructor.name;throw new Error(`@inject called with undefined this could mean that the class ${s} has a circular dependency problem. You can use a LazyServiceIdentifer to overcome this limitation.`)}W(new v(i,t))(n,e,r)}}var bn=Ot($);function mn(){return W(new v(O,!0))}function wn(){return function(i,t,n){at(i,t,n,new v(q,!0))}}var An=Ot(V);function Sn(i){return function(t,n,e){at(t,n,e,new v(nt,i))}}function $t(i,t){return()=>(n,e)=>{let r=new v(i,e);if(Reflect.hasOwnMetadata(i,n.constructor))throw new Error(t);Reflect.defineMetadata(i,r,n.constructor)}}var Tn=$t(F,"Cannot apply @postConstruct decorator multiple times in the same class"),In=$t(R,"Cannot apply @preDestroy decorator multiple times in the same class"),Dn=Wt,Nn=Kt;export{mt as AsyncContainerModule,l as BindingScopeEnum,h as BindingTypeEnum,vt as Container,bt as ContainerModule,Dn as LazyServiceIdentifer,Rn as LazyServiceIdentifier,Nn as METADATA_KEY,z as MetadataReader,Dt as TargetTypeEnum,W as createTaggedDecorator,pn as decorate,S as getServiceIdentifierAsString,D as id,bn as inject,fn as injectable,yn as multiBindToService,An as multiInject,vn as named,B as namedConstraint,mn as optional,Tn as postConstruct,In as preDestroy,_n as tagged,C as taggedConstraint,Sn as targetName,w as traverseAncerstors,H as typeConstraint,wn as unmanaged};
//# sourceMappingURL=inversify.mjs.map